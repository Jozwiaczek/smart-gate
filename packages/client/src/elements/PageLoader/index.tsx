import anime from 'animejs';
import React, { createRef, RefObject, useLayoutEffect, useMemo, useState } from 'react';

import { useMediaDevice } from '../../hooks';
import { LoaderBox, LoaderBoxItem, Wrapper } from './PageLoader.styled';
import { PageLoaderProps } from './PageLoader.types';

const loadingLetters = [
  'M6.29883 24.4697H5.79883V24.9697H6.29883V24.4697ZM15.6299 24.4697H16.1299V23.9697H15.6299V24.4697ZM15.6299 28V28.5H16.1299V28H15.6299ZM1.9043 28H1.4043V28.5H1.9043V28ZM1.9043 6.67188V6.17188H1.4043V6.67188H1.9043ZM6.29883 6.67188H6.79883V6.17188H6.29883V6.67188ZM6.29883 24.9697H15.6299V23.9697H6.29883V24.9697ZM15.1299 24.4697V28H16.1299V24.4697H15.1299ZM15.6299 27.5H1.9043V28.5H15.6299V27.5ZM2.4043 28V6.67188H1.4043V28H2.4043ZM1.9043 7.17188H6.29883V6.17188H1.9043V7.17188ZM5.79883 6.67188V24.4697H6.79883V6.67188H5.79883Z',
  'M20.4824 12.8682L20.2284 12.4375L20.2268 12.4384L20.4824 12.8682ZM29.6816 13.8203L29.3333 14.179L29.3346 14.1803L29.6816 13.8203ZM31.9521 19.1523L32.452 19.1388L32.4517 19.1282L32.4509 19.1176L31.9521 19.1523ZM31.9814 20.2363L32.4816 20.2363L32.4813 20.2228L31.9814 20.2363ZM29.9453 26.0957L30.3121 26.4356L30.3132 26.4343L29.9453 26.0957ZM19.0029 26.0957L18.6362 26.4356L18.6374 26.4369L19.0029 26.0957ZM22.0498 23.6934L21.6416 23.9821L21.6433 23.9845L22.0498 23.6934ZM26.8838 23.708L27.2862 24.0048L27.2879 24.0024L26.8838 23.708ZM22.0498 16.501L22.458 16.7897L22.4597 16.7874L22.0498 16.501ZM17.4668 19.9287C17.4668 18.4218 17.7566 17.0977 18.3236 15.9454L17.4264 15.5039C16.7825 16.8124 16.4668 18.2911 16.4668 19.9287H17.4668ZM18.3236 15.9454C18.8882 14.7981 19.6919 13.9201 20.738 13.2979L20.2268 12.4384C19.0073 13.1638 18.0728 14.1902 17.4264 15.5039L18.3236 15.9454ZM20.7364 13.2988C21.7922 12.6762 23.0254 12.3574 24.4521 12.3574V11.3574C22.8711 11.3574 21.4578 11.7125 20.2284 12.4375L20.7364 13.2988ZM24.4521 12.3574C26.4803 12.3574 28.0921 12.9738 29.3333 14.179L30.03 13.4616C28.5759 12.0497 26.7014 11.3574 24.4521 11.3574V12.3574ZM29.3346 14.1803C30.5862 15.3869 31.3039 17.0391 31.4534 19.187L32.4509 19.1176C32.2879 16.7734 31.4919 14.871 30.0287 13.4603L29.3346 14.1803ZM31.4523 19.1659L31.4816 20.2498L32.4813 20.2228L32.452 19.1388L31.4523 19.1659ZM31.4814 20.2363C31.4814 22.5707 30.8326 24.3936 29.5774 25.7571L30.3132 26.4343C31.7729 24.8486 32.4814 22.7652 32.4814 20.2363H31.4814ZM29.5786 25.7559C28.3298 27.1034 26.6495 27.793 24.4814 27.793V28.793C26.8837 28.793 28.846 28.0176 30.3121 26.4356L29.5786 25.7559ZM24.4814 27.793C22.3135 27.793 20.6274 27.1034 19.3685 25.7545L18.6374 26.4369C20.1128 28.0177 22.0791 28.793 24.4814 28.793V27.793ZM19.3697 25.7559C18.1187 24.4059 17.4668 22.547 17.4668 20.1191H16.4668C16.4668 22.7304 17.1723 24.8558 18.6362 26.4356L19.3697 25.7559ZM17.4668 20.1191V19.9287H16.4668V20.1191H17.4668ZM20.7002 20.2363C20.7002 21.792 20.9913 23.0627 21.6416 23.9821L22.458 23.4046C21.9755 22.7224 21.7002 21.6884 21.7002 20.2363H20.7002ZM21.6433 23.9845C22.3124 24.919 23.2813 25.3799 24.4814 25.3799V24.3799C23.5722 24.3799 22.92 24.0498 22.4563 23.4023L21.6433 23.9845ZM24.4814 25.3799C25.6552 25.3799 26.6097 24.922 27.2862 24.0048L26.4814 23.4112C26.0055 24.0565 25.3585 24.3799 24.4814 24.3799V25.3799ZM27.2879 24.0024C27.9584 23.082 28.248 21.6913 28.248 19.9287H27.248C27.248 21.6231 26.9616 22.752 26.4796 23.4136L27.2879 24.0024ZM28.248 19.9287C28.248 18.3978 27.9503 17.1384 27.2913 16.2113L26.4763 16.7907C26.9696 17.4847 27.248 18.5104 27.248 19.9287H28.248ZM27.2913 16.2113C26.6159 15.2611 25.6493 14.7852 24.4521 14.7852V15.7852C25.3449 15.7852 25.9994 16.1198 26.4763 16.7907L27.2913 16.2113ZM24.4521 14.7852C23.2628 14.7852 22.305 15.2629 21.64 16.2146L22.4597 16.7874C22.9274 16.118 23.5712 15.7852 24.4521 15.7852V14.7852ZM21.6416 16.2122C20.986 17.1391 20.7002 18.51 20.7002 20.2363H21.7002C21.7002 18.5837 21.9808 17.4644 22.458 16.7897L21.6416 16.2122Z',
  'M43.8105 28L43.3656 28.2282L43.505 28.5H43.8105V28ZM43.3857 26.5791L43.8798 26.5024L43.7181 25.4602L43.0136 26.2451L43.3857 26.5791ZM35.5195 26.9453L35.1882 27.3198L35.19 27.3214L35.5195 26.9453ZM35.8564 19.6797L35.5646 19.2737L35.5631 19.2748L35.8564 19.6797ZM41.2617 18.3174V17.8174L41.2596 17.8174L41.2617 18.3174ZM43.21 18.3174V18.8174H43.71V18.3174H43.21ZM42.6387 15.6514L42.2566 15.974L42.2608 15.9788L42.6387 15.6514ZM39.1816 15.5049L38.8615 15.1207L38.857 15.1246L39.1816 15.5049ZM38.5811 16.9111V17.4111H39.0811V16.9111H38.5811ZM34.3477 16.9111H33.8477V17.4111H34.3477V16.9111ZM37.5996 12.5312L37.795 12.9915L37.7987 12.9899L37.5996 12.5312ZM45.7295 13.3369L45.4028 13.7154L45.4062 13.7184L45.7295 13.3369ZM47.458 24.3379L46.958 24.3379L46.958 24.3411L47.458 24.3379ZM48.0879 27.751H48.5879V27.6263L48.5294 27.5163L48.0879 27.751ZM48.0879 28V28.5H48.5879V28H48.0879ZM42.0381 24.6455L42.2683 25.0894L42.2746 25.086L42.0381 24.6455ZM43.21 23.5176L43.6496 23.7557L43.71 23.6443V23.5176H43.21ZM43.21 20.793H43.71V20.293H43.21V20.793ZM38.2441 22.9902L37.7463 22.9438L37.7455 22.9523L37.745 22.9609L38.2441 22.9902ZM38.2295 23.2393L37.7304 23.2099L37.7295 23.2246V23.2393H38.2295ZM44.2555 27.7718C44.0912 27.4516 43.9621 27.0328 43.8798 26.5024L42.8917 26.6558C42.9851 27.2582 43.1393 27.7867 43.3656 28.2282L44.2555 27.7718ZM43.0136 26.2451C42.0902 27.2741 40.8963 27.793 39.3867 27.793V28.793C41.1583 28.793 42.6305 28.1692 43.7579 26.9131L43.0136 26.2451ZM39.3867 27.793C37.9372 27.793 36.7706 27.3767 35.849 26.5692L35.19 27.3214C36.3193 28.3108 37.7307 28.793 39.3867 28.793V27.793ZM35.8508 26.5708C34.9435 25.7682 34.4961 24.7722 34.4961 23.5469H33.4961C33.4961 25.0559 34.0643 26.3256 35.1882 27.3198L35.8508 26.5708ZM34.4961 23.5469C34.4961 22.0094 35.0533 20.8789 36.1498 20.0846L35.5631 19.2748C34.1791 20.2774 33.4961 21.7249 33.4961 23.5469H34.4961ZM36.1483 20.0857C37.2798 19.2724 38.9627 18.8269 41.2638 18.8174L41.2596 17.8174C38.8537 17.8274 36.933 18.2901 35.5646 19.2737L36.1483 20.0857ZM41.2617 18.8174H43.21V17.8174H41.2617V18.8174ZM43.71 18.3174V17.4092H42.71V18.3174H43.71ZM43.71 17.4092C43.71 16.5887 43.495 15.876 43.0165 15.3239L42.2608 15.9788C42.5441 16.3057 42.71 16.7649 42.71 17.4092H43.71ZM43.0207 15.3288C42.5205 14.7364 41.7613 14.4922 40.8662 14.4922V15.4922C41.5922 15.4922 42.0147 15.6874 42.2567 15.974L43.0207 15.3288ZM40.8662 14.4922C40.0758 14.4922 39.3878 14.6822 38.8615 15.1208L39.5017 15.889C39.7958 15.6439 40.2308 15.4922 40.8662 15.4922V14.4922ZM38.857 15.1246C38.3299 15.5745 38.0811 16.1906 38.0811 16.9111H39.0811C39.0811 16.4402 39.2326 16.1188 39.5063 15.8852L38.857 15.1246ZM38.5811 16.4111H34.3477V17.4111H38.5811V16.4111ZM34.8477 16.9111C34.8477 16.1042 35.0942 15.3563 35.6021 14.6558L34.7925 14.0688C34.1676 14.9308 33.8477 15.8821 33.8477 16.9111H34.8477ZM35.6021 14.6558C36.1068 13.9596 36.8295 13.4014 37.795 12.9915L37.4042 12.071C36.2994 12.54 35.4205 13.2026 34.7925 14.0688L35.6021 14.6558ZM37.7987 12.9899C38.7627 12.5716 39.8556 12.3574 41.0859 12.3574V11.3574C39.7381 11.3574 38.5069 11.5925 37.4006 12.0726L37.7987 12.9899ZM41.0859 12.3574C42.9551 12.3574 44.375 12.8282 45.4028 13.7154L46.0562 12.9584C44.7988 11.873 43.123 11.3574 41.0859 11.3574V12.3574ZM45.4062 13.7184C46.4263 14.5828 46.958 15.8086 46.958 17.4678H47.958C47.958 15.5722 47.3374 14.0442 46.0528 12.9555L45.4062 13.7184ZM46.958 17.4678V24.3379H47.958V17.4678H46.958ZM46.958 24.3411C46.968 25.8752 47.1802 27.1087 47.6464 27.9857L48.5294 27.5163C48.1753 26.8503 47.9676 25.8084 47.958 24.3346L46.958 24.3411ZM47.5879 27.751V28H48.5879V27.751H47.5879ZM48.0879 27.5H43.8105V28.5H48.0879V27.5ZM40.3096 25.5557C41.0104 25.5557 41.6661 25.4016 42.2682 25.0894L41.8079 24.2016C41.3554 24.4363 40.8588 24.5557 40.3096 24.5557V25.5557ZM42.2746 25.086C42.8771 24.7625 43.3436 24.3206 43.6496 23.7557L42.7703 23.2794C42.5685 23.6521 42.2538 23.9621 41.8015 24.205L42.2746 25.086ZM43.71 23.5176V20.793H42.71V23.5176H43.71ZM43.21 20.293H41.6279V21.293H43.21V20.293ZM41.6279 20.293C40.5228 20.293 39.5996 20.4819 38.9203 20.9229C38.2149 21.381 37.8273 22.0755 37.7463 22.9438L38.742 23.0367C38.7977 22.4401 39.0424 22.036 39.4649 21.7616C39.9136 21.4703 40.614 21.293 41.6279 21.293V20.293ZM37.745 22.9609L37.7304 23.2099L38.7286 23.2686L38.7433 23.0196L37.745 22.9609ZM37.7295 23.2393C37.7295 23.8992 37.9684 24.4695 38.4474 24.9107L39.1249 24.1752C38.8617 23.9328 38.7295 23.634 38.7295 23.2393H37.7295ZM38.4474 24.9107C38.9343 25.3592 39.5756 25.5557 40.3096 25.5557V24.5557C39.7545 24.5557 39.3802 24.4103 39.1249 24.1752L38.4474 24.9107Z',
  'M51.6221 14.0547L51.224 13.7521L51.2227 13.7538L51.6221 14.0547ZM60.001 13.5859L59.6243 13.9147L60.501 14.9191V13.5859H60.001ZM60.001 5.5V5H59.501V5.5H60.001ZM64.249 5.5H64.749V5H64.249V5.5ZM64.249 28V28.5H64.749V28H64.249ZM60.4258 28L59.9294 28.0604L59.983 28.5H60.4258V28ZM60.2207 26.3154L60.717 26.255L60.5733 25.0743L59.8303 26.0031L60.2207 26.3154ZM51.6514 26.0957L51.2536 26.3987L51.2558 26.4016L51.6514 26.0957ZM60.001 23.21L60.4506 23.4288L60.501 23.3252V23.21H60.001ZM60.001 16.9551H60.501V16.8417L60.4521 16.7395L60.001 16.9551ZM50.4668 19.958C50.4668 17.5585 51.0026 15.708 52.0214 14.3555L51.2227 13.7538C50.0345 15.3311 49.4668 17.4161 49.4668 19.958H50.4668ZM52.0202 14.3572C53.034 13.0233 54.4018 12.3574 56.1777 12.3574V11.3574C54.106 11.3574 52.4367 12.1564 51.224 13.7521L52.0202 14.3572ZM56.1777 12.3574C57.5778 12.3574 58.7143 12.8723 59.6243 13.9147L60.3777 13.2571C59.2759 11.9949 57.8636 11.3574 56.1777 11.3574V12.3574ZM60.501 13.5859V5.5H59.501V13.5859H60.501ZM60.001 6H64.249V5H60.001V6ZM63.749 5.5V28H64.749V5.5H63.749ZM64.249 27.5H60.4258V28.5H64.249V27.5ZM60.9221 27.9396L60.717 26.255L59.7244 26.3759L59.9294 28.0604L60.9221 27.9396ZM59.8303 26.0031C58.8686 27.2052 57.6537 27.793 56.1484 27.793V28.793C57.9635 28.793 59.4634 28.0624 60.6111 26.6278L59.8303 26.0031ZM56.1484 27.793C54.4367 27.793 53.0842 27.1312 52.0469 25.7898L51.2558 26.4016C52.4841 27.9899 54.1297 28.793 56.1484 28.793V27.793ZM52.0491 25.7928C51.0148 24.4347 50.4668 22.5097 50.4668 19.958H49.4668C49.4668 22.6407 50.0418 24.8075 51.2536 26.3986L52.0491 25.7928ZM53.7002 20.2656C53.7002 21.7963 53.965 23.0459 54.5582 23.9525L55.395 23.4049C54.953 22.7295 54.7002 21.7037 54.7002 20.2656H53.7002ZM54.5582 23.9525C55.1728 24.8919 56.0862 25.3652 57.2324 25.3652V24.3652C56.406 24.3652 55.8155 24.0476 55.395 23.4049L54.5582 23.9525ZM57.2324 25.3652C57.9575 25.3652 58.6083 25.2119 59.1626 24.8806C59.7188 24.548 60.1457 24.0552 60.4506 23.4288L59.5514 22.9911C59.3192 23.4682 59.0161 23.803 58.6494 24.0223C58.2808 24.2427 57.816 24.3652 57.2324 24.3652V25.3652ZM60.501 23.21V16.9551H59.501V23.21H60.501ZM60.4521 16.7395C60.1527 16.1129 59.7311 15.6191 59.1792 15.2857C58.6293 14.9534 57.9825 14.7998 57.2617 14.7998V15.7998C57.8398 15.7998 58.2989 15.9221 58.6621 16.1416C59.0233 16.3599 59.3219 16.6937 59.5498 17.1707L60.4521 16.7395ZM57.2617 14.7998C56.0782 14.7998 55.1466 15.2949 54.54 16.2789C53.9578 17.2231 53.7002 18.5752 53.7002 20.2656H54.7002C54.7002 18.6455 54.9528 17.5147 55.3912 16.8037C55.8051 16.1324 56.4043 15.7998 57.2617 15.7998V14.7998Z',
  'M72.0938 28V28.5H72.5938V28H72.0938ZM67.8457 28H67.3457V28.5H67.8457V28ZM67.8457 12.1504V11.6504H67.3457V12.1504H67.8457ZM72.0938 12.1504H72.5938V11.6504H72.0938V12.1504ZM68.2266 6.48145L67.8813 6.11974L67.8772 6.12376L68.2266 6.48145ZM71.6836 9.63086L71.3424 9.26531L71.3384 9.26918L71.6836 9.63086ZM68.2412 9.63086L67.896 9.99256L67.9001 9.99639L68.2412 9.63086ZM72.0938 27.5H67.8457V28.5H72.0938V27.5ZM68.3457 28V12.1504H67.3457V28H68.3457ZM67.8457 12.6504H72.0938V11.6504H67.8457V12.6504ZM71.5938 12.1504V28H72.5938V12.1504H71.5938ZM68.0967 8.04883C68.0967 7.53657 68.2607 7.14705 68.5759 6.83913L67.8772 6.12376C67.3526 6.63616 67.0967 7.29156 67.0967 8.04883H68.0967ZM68.5718 6.84312C68.8879 6.54138 69.3343 6.36621 69.9697 6.36621V5.36621C69.1403 5.36621 68.4246 5.60119 67.8813 6.11977L68.5718 6.84312ZM69.9697 6.36621C70.5933 6.36621 71.0357 6.5402 71.353 6.84312L72.0435 6.11977C71.5015 5.60238 70.7915 5.36621 69.9697 5.36621V6.36621ZM71.353 6.84312C71.6765 7.15195 71.8428 7.54025 71.8428 8.04883H72.8428C72.8428 7.28788 72.5793 6.63126 72.0435 6.11977L71.353 6.84312ZM71.8428 8.04883C71.8428 8.56597 71.6727 8.95712 71.3424 9.26533L72.0248 9.99639C72.5734 9.48429 72.8428 8.82075 72.8428 8.04883H71.8428ZM71.3384 9.26918C71.0197 9.57332 70.5814 9.74609 69.9697 9.74609V10.7461C70.7839 10.7461 71.4881 10.5087 72.0288 9.99254L71.3384 9.26918ZM69.9697 9.74609C69.3584 9.74609 68.9124 9.57339 68.5824 9.26533L67.9001 9.99639C68.4489 10.5086 69.1552 10.7461 69.9697 10.7461V9.74609ZM68.5864 9.26918C68.2646 8.96193 68.0967 8.56963 68.0967 8.04883H67.0967C67.0967 8.81709 67.3585 9.47948 67.896 9.99254L68.5864 9.26918Z',
  'M79.5225 12.1504L80.0212 12.1145L79.9878 11.6504H79.5225V12.1504ZM79.6543 13.9814L79.1556 14.0174L79.2473 15.2906L80.0447 14.2938L79.6543 13.9814ZM87.96 13.3369L88.3444 13.0172L87.96 13.3369ZM89.2197 17.7607L89.7198 17.7607L89.7197 17.7558L89.2197 17.7607ZM89.2197 28V28.5H89.7197V28H89.2197ZM84.9863 28H84.4863V28.5H84.9863V28ZM84.4004 15.915L84.0383 16.2599L84.0425 16.2642L84.4004 15.915ZM79.7715 16.8232L79.3402 16.5703L79.2715 16.6874V16.8232H79.7715ZM79.7715 28V28.5H80.2715V28H79.7715ZM75.5381 28H75.0381V28.5H75.5381V28ZM75.5381 12.1504V11.6504H75.0381V12.1504H75.5381ZM79.0238 12.1863L79.1556 14.0174L80.153 13.9455L80.0212 12.1145L79.0238 12.1863ZM80.0447 14.2938C81.0773 13.0031 82.4488 12.3574 84.21 12.3574V11.3574C82.1626 11.3574 80.4969 12.1278 79.2639 13.6691L80.0447 14.2938ZM84.21 12.3574C85.7903 12.3574 86.8778 12.8176 87.5755 13.6566L88.3444 13.0172C87.4015 11.8835 85.989 11.3574 84.21 11.3574V12.3574ZM87.5755 13.6566C88.2921 14.5182 88.7008 15.8598 88.7198 17.7657L89.7197 17.7558C89.6996 15.7359 89.2684 14.1282 88.3444 13.0172L87.5755 13.6566ZM88.7197 17.7607V28H89.7197V17.7607H88.7197ZM89.2197 27.5H84.9863V28.5H89.2197V27.5ZM85.4863 28V17.8633H84.4863V28H85.4863ZM85.4863 17.8633C85.4863 16.9101 85.2819 16.1026 84.7583 15.5659L84.0425 16.2642C84.3001 16.5283 84.4863 17.0196 84.4863 17.8633H85.4863ZM84.7625 15.5702C84.2337 15.015 83.4172 14.7998 82.4521 14.7998V15.7998C83.3035 15.7998 83.7858 15.9947 84.0383 16.2599L84.7625 15.5702ZM82.4521 14.7998C81.0859 14.7998 80.027 15.3994 79.3402 16.5703L80.2028 17.0762C80.7074 16.2158 81.4355 15.7998 82.4521 15.7998V14.7998ZM79.2715 16.8232V28H80.2715V16.8232H79.2715ZM79.7715 27.5H75.5381V28.5H79.7715V27.5ZM76.0381 28V12.1504H75.0381V28H76.0381ZM75.5381 12.6504H79.5225V11.6504H75.5381V12.6504Z',
  'M93.7393 14.084L93.3456 13.7758L93.3443 13.7774L93.7393 14.084ZM102.484 13.6445L102.096 13.9596L102.843 14.8794L102.981 13.703L102.484 13.6445ZM102.66 12.1504V11.6504H102.216L102.164 12.092L102.66 12.1504ZM106.498 12.1504H106.998V11.6504H106.498V12.1504ZM105.546 31.0908L105.121 30.8276L105.119 30.8306L105.546 31.0908ZM95.4824 33.5371L95.6779 33.0769L95.6744 33.0755L95.4824 33.5371ZM92.9775 31.75L92.5732 31.4559L92.3526 31.7592L92.582 32.0559L92.9775 31.75ZM94.8525 29.1719L95.2256 28.8389L94.8128 28.3765L94.4482 28.8778L94.8525 29.1719ZM101.312 30.0361L100.968 29.6742L100.965 29.677L101.312 30.0361ZM102.25 26.6377H102.75V25.3182L101.876 26.3063L102.25 26.6377ZM93.7686 26.0664L93.3751 26.375L93.3774 26.3778L93.7686 26.0664ZM97.1084 23.6494L96.6992 23.9368L96.7009 23.9391L97.1084 23.6494ZM102.25 23.415L102.683 23.6645L102.75 23.5487V23.415H102.25ZM102.25 16.75H102.75V16.6143L102.681 16.4973L102.25 16.75ZM97.1084 16.5449L96.6999 16.2566L96.6977 16.2598L97.1084 16.5449ZM92.5107 19.958C92.5107 17.6045 93.0677 15.7644 94.1342 14.3906L93.3443 13.7774C92.1061 15.3723 91.5107 17.4482 91.5107 19.958H92.5107ZM94.133 14.3922C95.1958 13.0346 96.6102 12.3574 98.4268 12.3574V11.3574C96.3175 11.3574 94.6069 12.1646 93.3456 13.7758L94.133 14.3922ZM98.4268 12.3574C100.037 12.3574 101.238 12.9017 102.096 13.9596L102.873 13.3295C101.798 12.0046 100.293 11.3574 98.4268 11.3574V12.3574ZM102.981 13.703L103.157 12.2088L102.164 12.092L101.988 13.5861L102.981 13.703ZM102.66 12.6504H106.498V11.6504H102.66V12.6504ZM105.998 12.1504V27.4727H106.998V12.1504H105.998ZM105.998 27.4727C105.998 28.7806 105.7 29.8926 105.121 30.8276L105.971 31.354C106.662 30.2383 106.998 28.9381 106.998 27.4727H105.998ZM105.119 30.8306C104.548 31.7679 103.74 32.4844 102.682 32.9821L103.107 33.8871C104.334 33.3105 105.294 32.4646 105.973 31.3511L105.119 30.8306ZM102.682 32.9821C101.619 33.4819 100.356 33.7402 98.8809 33.7402V34.7402C100.472 34.7402 101.885 34.4614 103.107 33.8871L102.682 32.9821ZM98.8809 33.7402C97.7881 33.7402 96.7216 33.5202 95.6779 33.0769L95.2869 33.9973C96.4503 34.4915 97.6494 34.7402 98.8809 34.7402V33.7402ZM95.6744 33.0755C94.6284 32.6404 93.873 32.0906 93.3731 31.4441L92.582 32.0559C93.2149 32.8742 94.1295 33.5159 95.2904 33.9988L95.6744 33.0755ZM93.3819 32.0441L95.2569 29.466L94.4482 28.8778L92.5732 31.4559L93.3819 32.0441ZM94.4795 29.5048C95.6234 30.7863 97.0357 31.4443 98.6904 31.4443V30.4443C97.3373 30.4443 96.1911 29.9207 95.2256 28.8389L94.4795 29.5048ZM98.6904 31.4443C99.9041 31.4443 100.917 31.1151 101.66 30.3953L100.965 29.677C100.458 30.1681 99.7229 30.4443 98.6904 30.4443V31.4443ZM101.657 30.3981C102.407 29.6835 102.75 28.6874 102.75 27.4873H101.75C101.75 28.4942 101.468 29.1974 100.968 29.6742L101.657 30.3981ZM102.75 27.4873V26.6377H101.75V27.4873H102.75ZM101.876 26.3063C101.002 27.2933 99.859 27.793 98.3975 27.793V28.793C100.12 28.793 101.545 28.1891 102.624 26.9691L101.876 26.3063ZM98.3975 27.793C96.6448 27.793 95.2461 27.1197 94.1597 25.755L93.3774 26.3778C94.6543 27.9819 96.3415 28.793 98.3975 28.793V27.793ZM94.162 25.7578C93.0773 24.3748 92.5107 22.5162 92.5107 20.1338H91.5107C91.5107 22.6732 92.1161 24.7697 93.3751 26.375L94.162 25.7578ZM92.5107 20.1338V19.958H91.5107V20.1338H92.5107ZM95.7441 20.2656C95.7441 21.7614 96.0434 23.0031 96.6992 23.9368L97.5176 23.362C97.021 22.6551 96.7441 21.641 96.7441 20.2656H95.7441ZM96.7009 23.9391C97.3721 24.8834 98.3159 25.3652 99.4814 25.3652V24.3652C98.6353 24.3652 97.997 24.0365 97.5159 23.3597L96.7009 23.9391ZM99.4814 25.3652C100.916 25.3652 102.022 24.8131 102.683 23.6645L101.817 23.1656C101.365 23.9506 100.625 24.3652 99.4814 24.3652V25.3652ZM102.75 23.415V16.75H101.75V23.415H102.75ZM102.681 16.4973C102.013 15.3557 100.921 14.7998 99.5107 14.7998V15.7998C100.62 15.7998 101.355 16.2107 101.819 17.0027L102.681 16.4973ZM99.5107 14.7998C98.3326 14.7998 97.3795 15.2938 96.6999 16.2566L97.5169 16.8333C98.0092 16.1358 98.6577 15.7998 99.5107 15.7998V14.7998ZM96.6977 16.2598C96.0371 17.2115 95.7441 18.5721 95.7441 20.2656H96.7441C96.7441 18.6584 97.0274 17.5385 97.5191 16.83L96.6977 16.2598Z',
];

const PageLoader = ({ size }: PageLoaderProps) => {
  const [targets, setTargets] = useState<Array<RefObject<HTMLDivElement>>>([]);
  const [letterTargets, setLetterTargets] = useState<Array<RefObject<SVGPathElement>>>([]);
  const { isMobile } = useMediaDevice();

  let sizeInternal = isMobile ? 10 : 20;
  if (size) {
    sizeInternal = size;
  }
  const grid = useMemo(() => [sizeInternal, sizeInternal], [sizeInternal]);
  const numberOfBoxItems = sizeInternal ** 2;

  const createBoxItems = useMemo(
    () =>
      [...Array.from(Array(numberOfBoxItems), (_, index) => index + 1)].map((key) => {
        const ref = createRef<HTMLDivElement>();
        setTargets((prev) => [...prev, ref]);
        return <LoaderBoxItem key={key} ref={ref} />;
      }),
    [numberOfBoxItems],
  );

  const loadingLettersPaths = useMemo(
    () =>
      loadingLetters.map((path, index) => {
        const ref = createRef<SVGPathElement>();
        setLetterTargets((prev) => [...prev, ref]);
        // eslint-disable-next-line react/no-array-index-key
        return <path key={index} ref={ref} d={path} stroke="currentColor" strokeWidth={1} />;
      }),
    [],
  );

  useLayoutEffect(() => {
    anime
      .timeline({
        targets: targets.map((boxItem) => boxItem.current),
        easing: 'easeInOutSine',
        delay: anime.stagger(50),
        loop: true,
      })
      .add({
        translateX: [
          { value: anime.stagger('-.1rem', { grid, from: 'center', axis: 'x' }) },
          { value: anime.stagger('.1rem', { grid, from: 'center', axis: 'x' }) },
        ],
        translateY: [
          { value: anime.stagger('-.1rem', { grid, from: 'center', axis: 'y' }) },
          { value: anime.stagger('.1rem', { grid, from: 'center', axis: 'y' }) },
        ],
        duration: 1000,
        scale: 0.5,
        delay: anime.stagger(100, { grid, from: 'center' }),
      })
      .add({
        translateX: anime.stagger('.25rem', { grid, from: 'center', axis: 'x' }),
        translateY: anime.stagger('.25rem', { grid, from: 'center', axis: 'y' }),
        rotate: 0,
        scaleX: 2.5,
        scaleY: 0.25,
        delay: anime.stagger(4, { from: 'center' }),
      })
      .add({
        rotate: anime.stagger([90, 0], { grid, from: 'center' }),
        delay: anime.stagger(50, { grid, from: 'center' }),
      })
      .add({
        translateX: 0,
        translateY: 0,
        scale: 0.5,
        scaleX: 1,
        rotate: 180,
        duration: 1000,
        delay: anime.stagger(100, { grid, from: 'center' }),
      })
      .add({
        scaleY: 1,
        scale: 1,
        delay: anime.stagger(20, { grid, from: 'center' }),
      });
  }, [grid, targets]);

  useLayoutEffect(() => {
    anime({
      targets: letterTargets.map((boxItem) => boxItem.current),
      strokeDashoffset: [anime.setDashoffset, 0],
      easing: 'easeInOutSine',
      duration: 1500,
      delay(el, i) {
        return i * 250;
      },
    });
  }, [letterTargets]);

  return (
    <Wrapper data-testid="pageLoader">
      <LoaderBox size={sizeInternal}>{createBoxItems}</LoaderBox>
      <div>
        <svg
          width="100%"
          height="auto"
          viewBox="0 0 109 35"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          {loadingLettersPaths}
        </svg>
      </div>
    </Wrapper>
  );
};

PageLoader.displayName = 'PageLoader';

export default PageLoader;
